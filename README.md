# uploadmonitor   
_English version in prep._

## 概要
- 数分間隔で継続的にファイルを特定のフォルダに送信するような処理を行っている時に，その処理が止まっていないかモニタリングします．
- 監視先のフォルダは3つ選べます．
- 監視する時間間隔は1,2,3,4,5,6,12,15,20,30分，または，1時間以上（1時間単位）で設定できます．
- ファイルが指定したフォルダに送信されていなければ（フォルダ内のファイル数が増えていなければ），チャットワークに通知します．
- MacOS向けに制作しています．LinuxやWindowsでも動作すると思いますが部分的に修正する必要があるかもしれません，

## MacOSへの導入方法（初心者向け）
- 今見ているこのサイト(https://github.com/ytakeda-paleo/num-files-monitor)からcode→download zipでスクリプトをダウンロードしてください．
- ダウンロードしたzipを展開してください．
- jaフォルダ内のファイルをすべて，Macのホームディレクトリ（Finder→ユーザー→hogehoge（例））にペーストしてください．
  - フォルダごとペーストではなく，フォルダ内のファイルのみペーストします．
- ターミナルアプリを起動し，（カレントディレクトリがホームディレクトリの状態で）以下を入力します．
  - `sudo chmod +x *.sh`
- MacOSの「システム環境設定」の「セキュリティとプライバシー」にある「フルディスクアクセス」「ファイルとフォルダ」「デベロッパツール」に「ターミナル」アプリ（アプリ>ユーティリティ)を追加して許可してください．
  - 「フルディスクアクセス」に追加すると「ファイルとフォルダ」にも自動的に追加されるはずです．
- MacOSの「システム環境設定」の「セキュリティとプライバシー」にある「フルディスクアクセス」「ファイルとフォルダ」に「cron」を追加して許可してください．
  - ファイル選択のダイアログで [command] + [shift] + [G] を押すと，フォルダへ移動するボックスがあらわれるので，`/usr/sbin/cron` と入力して表示される`cron`を追加します.
- `uploadmonitor-config.sh`をテキストエディット（または他のエディタアプリ）で開いて，以下の箇所を編集します．
  - `FILE_LOG[1][2][3]`,`EXE[1][2][3]`,`CRON[1][2][3]`内のhogehogeを自分のユーザー名に置き換えてください．
  - `CHATWORK_API_KEY="put-api-key-here"`と`CHATWORK_ROOM_ID="put-room-id-here"`に，APIキーとルームIDを入力してください．
- `uploadmonitor-settings.sh`を同様に開いて，以下を箇所を編集します．
  - 131行目と134行目のhogehogeを自分のユーザー名に置き換えてください．

## 起動方法
- ターミナルアプリを起動し，（カレントディレクトリがホームディレクトリの状態で）以下を入力します．   
` sh uploadmonitor-settings.sh`   
- 表示画面に従って，フォルダ番号を入力し，操作します．
- 終了時はCtrl + X で終了します．

## 補足
- 監視オン直後にアラートが発生することがありますが，処理上の仕様です．(crontabで実行しているためです)
- Windows→iMacにUSBメモリ経由でスクリプトファイルをコピペする，といったことは避けてください（OS間で改行コードが異なるので，この方法でペーストしたスクリプトは動きません）
- シェルスクリプトで作った意図：python2しか入っていない古いiMacで起動させるため（python3をインストールしたくなかった）
- 仕組み：crontabで`find . -type f | wc -l`で指定フォルダ内のファイル数をカウントし，一つ前にカウントしたファイル数と比較．ファイル数が増えていなければアラートを出します．
